From: Samuel Thibault <samuel.thibault@ens-lyon.org>
Subject: [PATCH] Make F_WRLCK potentially upgrade owned F_RDLCK

lockf(LOCK_EX) would drop any existing shared lock before taking the exclusive
lock. F_WRLCK needs an atomic upgrade, so use lockf(LOCK_SH|LOCK_EX) instead.

Signed-off-by: Samuel Thibault <samuel.thibault@ens-lyon.org>

* sysdeps/mach/hurd/fcntl.c (__libc_fcntl): For F_WRLCK, set cmd to
LOCK_SH|LOCK_EX instead of LOCK_SH.
